set windows-shell := ["pwsh.exe", "-c"]

[windows]
run $RUST_BACKTRACE="1":
    New-Item -ItemType Directory -Path build -Force
    cd build && cmake .. && cmake --build .
    .\build\Debug\PulumiNativeCPP.exe

[unix]
run $RUST_BACKTRACE="1":
    mkdir -p build
    cd build && cmake .. && cmake --build .
    ./build/PulumiNativeCPP

[windows]
local-test:
    #!pwsh
    Set-StrictMode -Version Latest
    $ErrorActionPreference = "Stop"
    $PSNativeCommandUseErrorActionPreference = $true

    cargo build -p pulumi_gestalt_runner --release
    cargo component build -p pulumi_gestalt --release
    cargo component build -p pulumi_gestalt_example_simple --release
    $env:PULUMI_CONFIG_PASSPHRASE=" "
    pulumi destroy -y
    pulumi up -y